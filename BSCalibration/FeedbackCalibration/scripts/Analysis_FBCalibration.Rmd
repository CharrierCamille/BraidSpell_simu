---
title: "Analysis_FBCalibration"
author: "Camille Charrier"
date: "2025-02-17"
output:
  html_document:
    df_print: paged
    toc: true
    theme: lumen
    toc_float: true
    number_sections: true
    highlight: tango
    fig_caption: true
    code_folding: hide
---

```{r setup, include=FALSE} 
knitr::opts_chunk$set(warning = FALSE, message = FALSE,fig.align="center") 
options(encoding = 'UTF-8')
```

# - Abstract

Calibration of feedback ratio of the BRAID-Spell model, for both reading and spelling tasks.


# - Pretreatments

## - Import

Load of packages needed for the further computations

```{r}
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyr)
library(colorspace)
```

## - Global variables

Load of the global variables needed for the import of databases and the plots

```{r}
path_read_w = "../results/reading_word_feedback_raw.csv"
path_read_pw = "../results/reading_pseudoword_feedback_raw.csv"
path_stim_read = "../data/processed/reading_feedback_stim.csv"

path_spell_w = "../results/spelling_word_feedback_raw.csv"
path_spell_pw = "../results/spelling_pseudoword_feedback_raw.csv"
path_stim_spell = "../data/processed/spelling_feedback_stim.csv"


cbp <- c("#FFB23D", "#38A29A", "#19609E", "#009E73",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

cbp2 <- c("#FFB23D", "#18578E", "#35C3B8", "#009E73",
          "#F0E442", "#0072B2", "#D55E00", "#CC79A7")

```

## - Load stim

Load the stim list into dataframe

```{r}
stim_read = read.csv(path_stim_read,sep=",",fileEncoding="UTF-8")
stim_spell = read.csv(path_stim_spell,sep=",",fileEncoding="UTF-8")

```

## - Load results

Load the simulation results into dataframe

```{r}
raw_read_w = read.csv(path_read_w,sep=",",fileEncoding="UTF-8") %>% select(-c(t,success,error_type))
raw_read_pw = read.csv(path_read_pw,sep=",",fileEncoding="UTF-8") %>% select(-c(t,success,error_type))

raw_spell_w = read.csv(path_spell_w,sep=",",fileEncoding="UTF-8") %>% select(-c(t,success,error_type))
raw_spell_pw = read.csv(path_spell_pw,sep=",",fileEncoding="UTF-8") %>% select(-c(t,success,error_type))

```

## - Pre-process results

Transform raw dataframes into easily usable processed dataframes

```{r}
data_read_w = raw_read_w %>% 
    mutate(num = case_when(num==0~"t_tot", num==1~"ld_ortho",num==2~"ld_phono",
                           num==3~"phi",num==4~"let",num==5~"simu_time"))  %>% 
    pivot_wider(names_from = "num",values_from = "value")  %>% 
    mutate(t_tot = as.integer(t_tot), 
           len=nchar(word)-2, 
           task="Reading", 
           type="Word",
           ld_ortho=as.numeric(ld_ortho), 
           ld_phono=as.numeric(ld_phono), 
           simu_time=round(as.numeric(simu_time))) %>%
    mutate(word=gsub("!","",word),
           phi=gsub("!","", phi),
           let=gsub("!","",let)) %>%
    mutate(phi=gsub("~","",phi),
           let=gsub("~","",let)) %>%
    inner_join(stim_read %>% select(c(word,len,pron)),by=c("word"="word","len"="len"))  %>%
    mutate(success = (phi==pron)) 

data_read_pw = raw_read_pw %>% 
    mutate(num = case_when(num==0~"t_tot", num==1~"ld_ortho",num==2~"ld_phono",
                           num==3~"phi",num==4~"let",num==5~"simu_time"))  %>% 
    pivot_wider(names_from = "num",values_from = "value")  %>% 
    mutate(t_tot = as.integer(t_tot), 
           len=nchar(word)-2, 
           task="Reading",
           type="Pseudoword",
           ld_ortho=as.numeric(ld_ortho), 
           ld_phono=as.numeric(ld_phono), 
           simu_time=round(as.numeric(simu_time))) %>%
    mutate(word=gsub("!","",word),
           phi=gsub("!","", phi),
           let=gsub("!","",let)) %>%
    mutate(phi=gsub("~","",phi),
           let=gsub("~","",let)) %>%
    inner_join(stim_read %>% select(c(word,len,pron)),by=c("word"="word","len"="len"))  %>%
    mutate(success = (phi==pron))

data_spell_w = raw_spell_w %>% 
    mutate(num = case_when(num==0~"t_tot", num==1~"ld_ortho",num==2~"ld_phono",
                           num==3~"phi",num==4~"let",num==5~"simu_time"))  %>% 
    pivot_wider(names_from = "num",values_from = "value")  %>%
    unnest(cols = c(t_tot, ld_ortho, ld_phono, phi, let, simu_time)) %>%
    mutate(t_tot = as.integer(t_tot), 
           len=nchar(word)-2, 
           task="Spelling",
           type="Word",
           ld_ortho=as.numeric(ld_ortho), 
           ld_phono=as.numeric(ld_phono), 
           simu_time=round(as.numeric(simu_time))) %>%
    mutate(word=gsub("!","",word),
           phi=gsub("!","", phi),
           let=gsub("!","",let)) %>%
    mutate(phi=gsub("~","",phi),
           let=gsub("~","",let)) %>%
    inner_join(stim_spell %>% select(c(word,len,phlen,pron)),by=c("word"="pron","len"="phlen"))  %>%
    mutate(success = (let==word.y)) %>% select(-c(word.y,len.y))

data_spell_pw = raw_spell_pw %>%
    mutate(num = case_when(num==0~"t_tot", num==1~"ld_ortho",num==2~"ld_phono",
                           num==3~"phi",num==4~"let",num==5~"simu_time"))  %>%
    pivot_wider(names_from = "num",values_from = "value")  %>%
    mutate(t_tot = as.integer(t_tot),
           len=nchar(word)-2,
           task="Spelling",
           type="Pseudoword",
           ld_ortho=as.numeric(ld_ortho),
           ld_phono=as.numeric(ld_phono),
           simu_time=round(as.numeric(simu_time))) %>%
    mutate(word=gsub("!","",word),
           phi=gsub("!","", phi),
           let=gsub("!","",let)) %>%
    mutate(phi=gsub("~","",phi),
          let=gsub("~","",let))  %>%
    inner_join(stim_spell %>% select(c(word,len,phlen,pron)),by=c("word"="pron","len"="phlen"))  %>%
    mutate(success = (let==word.y)) %>% select(-c(word.y,len.y))

data_full_read=rbind(data_read_w,data_read_pw)
data_full_spell=rbind(data_spell_w,data_spell_pw)
```

# - Results

## - Reading

### - Success by decoding_ratio_po

```{r}
data_full_read %>% 
    group_by(task,decoding_ratio_po,type) %>% 
    summarise(error=sum(!success),n=n()) %>%
    ggplot(aes(x=decoding_ratio_po,y=100-(error/n)*100,color=decoding_ratio_po,group=decoding_ratio_po)) +
        geom_point() + 
        theme_classic(14) +
        geom_vline(xintercept=0.00175,linetype=2)+ 
        scale_color_continuous_sequential(palette = "Viridis") + 
        labs(x="Kff", y="% de succès", color="Kff")+
        theme(legend.key.width= unit(0.3, 'cm')) +
        ylim(0,100)+
        facet_wrap(~type)

```

### - Processing time by decoding_ratio_po

```{r}
data_full_read %>% 
    filter(success) %>%
    group_by(task,type,decoding_ratio_po,len) %>% 
    summarise(m_time =mean(t_tot), sd_time= sd(t_tot)) %>% 
    ggplot(aes(x=len,y=m_time,color=decoding_ratio_po,group=decoding_ratio_po)) +
        geom_line() + 
        theme_classic(14) + 
        scale_color_continuous_sequential(palette = "Viridis") + 
        labs(x="Longueur orthographique", y="Temps (itérations)", color="Kff")+
        theme(legend.key.width= unit(0.3, 'cm')) +
        ylim(c(0,5000))+
        facet_wrap(~type)

```

## - Spelling

### - Success by decoding_ratio_op

```{r}
data_full_spell %>% 
    group_by(task,decoding_ratio_op,type) %>% 
    summarise(error=sum(!success),n=n()) %>%
    ggplot(aes(x=decoding_ratio_op,y=100-(error/n)*100,color=decoding_ratio_op,group=decoding_ratio_op)) +
        geom_point() + 
        theme_classic(14) +
        geom_vline(xintercept=0.00175,linetype=2)+ 
        scale_color_continuous_sequential(palette = "Viridis") + 
        labs(x="Kff", y="% de succès", color="Kff")+
        theme(legend.key.width= unit(0.3, 'cm')) +
        ylim(0,100)+
        facet_wrap(~type)

```

### - Processing time by decoding_ratio_op

```{r}
data_full_spell %>% 
    filter(success) %>%
    group_by(task,type,decoding_ratio_op,len) %>% 
    summarise(m_time =mean(t_tot), sd_time= sd(t_tot)) %>% 
    ggplot(aes(x=len,y=m_time,color=decoding_ratio_op,group=decoding_ratio_op)) +
        geom_line() + 
        theme_classic(14) + 
        scale_color_continuous_sequential(palette = "Viridis") + 
        labs(x="Longueur phonologique", y="Temps (itérations)", color="Kff")+
        theme(legend.key.width= unit(0.3, 'cm')) +
        ylim(c(0,5000))+
        facet_wrap(~type)

```